<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disaster Message Statistics</title>
</head>
<body>
<div id="chartContainer">
    <canvas id="myChart"></canvas>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script>
// JSON 데이터를 함수로 받아 그래프를 그리는 함수
function drawChart(jsonData) {
    // JSON 데이터를 파싱하여 지역명과 재난 문자 개수 추출
    const labels = jsonData.map(item => item.region);
    const data = jsonData.map(item => item.count);

    // 색상 팔레트 정의
    const colorPalette = [
        'rgba(75, 192, 192, 0.2)',
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(255, 206, 86, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(255, 159, 64, 0.2)',
        'rgba(199, 199, 199, 0.2)',
        'rgba(83, 102, 255, 0.2)',
        'rgba(60, 179, 113, 0.2)',
        'rgba(255, 140, 0, 0.2)',
        'rgba(75, 192, 192, 0.2)',
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(255, 206, 86, 0.2)',
        'rgba(153, 102, 255, 0.2)',
        'rgba(255, 159, 64, 0.2)',
        'rgba(199, 199, 199, 0.2)'
    ];

    const borderColorPalette = colorPalette.map(color => color.replace('0.2', '1'));

    // 각 데이터 항목에 대해 색상을 순환하여 적용
    const backgroundColors = data.map((_, index) => colorPalette[index % colorPalette.length]);
    const borderColors = data.map((_, index) => borderColorPalette[index % borderColorPalette.length]);

    // 그래프를 그릴 캔버스 요소 선택
    const ctx = document.getElementById('myChart').getContext('2d');

    // Chart.js를 사용하여 그래프 생성
    new Chart(ctx, {
        type: 'bar', // 수직 막대 그래프
        data: {
            labels: labels,
            datasets: [{
                label: 'Disaster Messages',
                data: data,
                backgroundColor: backgroundColors, // 각 지역별로 다른 색상 적용
                borderColor: borderColors, // 각 지역별로 다른 테두리 색상 적용
                borderWidth: 1 // 막대 그래프 테두리 두께
            }]
        },
        options: {
            indexAxis: 'x', // x축을 기준으로 막대를 수직으로 설정
            responsive: true,
            maintainAspectRatio: false, // 비율 유지를 해제
            scales: {
                y: {
                    beginAtZero: true, // y축의 시작을 0으로 설정
                    title: {
                        display: true,
                        text: '메시지 수', // y축 라벨 추가
                        font: {
                            size: 16 // y축 라벨 텍스트 크기 조정
                        }
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: '지역', // x축 라벨 추가
                        font: {
                            size: 16 // x축 라벨 텍스트 크기 조정
                        }
                    },
                    ticks: {
                        autoSkip: false, // 모든 라벨 표시
                        maxRotation: 0, // 최대 회전 각도
                        minRotation: 0 // 최소 회전 각도
                    },
                    grid: {
                        display: false // x축 그리드 숨기기
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw} messages`;
                        }
                    }
                }
            },
            // 막대 너비 조정
            barPercentage: 0.5, // 막대 너비를 50%로 설정
            categoryPercentage: 0.8 // 카테고리 너비를 80%로 설정
        }
    });
}

// 예제 JSON 데이터 (17개 지역)
const exampleData = [
    { "region": "서울", "count": 120 },
    { "region": "부산", "count": 95 },
    { "region": "인천", "count": 80 },
    { "region": "대구", "count": 70 },
    { "region": "광주", "count": 50 },
    { "region": "대전", "count": 45 },
    { "region": "울산", "count": 40 },
    { "region": "세종", "count": 30 },
    { "region": "경기", "count": 200 },
    { "region": "강원", "count": 25 },
    { "region": "충북", "count": 35 },
    { "region": "충남", "count": 55 },
    { "region": "전북", "count": 60 },
    { "region": "전남", "count": 65 },
    { "region": "경북", "count": 75 },
    { "region": "경남", "count": 85 },
    { "region": "제주", "count": 20 }
];

// 예제 데이터를 사용하여 그래프 그리기
drawChart(exampleData);
</script>

<style>
    #chartContainer {
        height: 500px;
        width: 500px; /* 차트 컨테이너의 너비를 줄임 */
        max-width: 600px; /* 최대 너비를 설정 */
        margin: auto; /* 가운데 정렬 */
    }
</style>
</body>
</html>